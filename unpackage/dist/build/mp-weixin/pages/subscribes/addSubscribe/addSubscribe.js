(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribes/addSubscribe/addSubscribe"],{"0587":function(e,t,s){"use strict";s.r(t);var n=s("2223"),i=s.n(n);for(var o in n)"default"!==o&&function(e){s.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},2223:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(s("bd19"));function i(e){return e&&e.__esModule?e:{default:e}}var o=function(){s.e("components/label").then(function(){return resolve(s("8b13"))}.bind(null,s)).catch(s.oe)},c=function(){s.e("components/tki-tree/tki-tree").then(function(){return resolve(s("5c78"))}.bind(null,s)).catch(s.oe)},a={data:function(){return{zbList:[{value:"1",label:"不限"},{value:"2",label:"招标"},{value:"3",label:"中标"}],list:[{id:0,value:"按关键字"},{id:1,value:"按行业"}],current:0,city:[{name:"北京",value:1},{name:"上海",value:2},{name:"广州",value:3},{name:"深圳",value:4}],biddingType:"不限",keyword:"",email:"",zbShow:!1,areaList:"",UserInfo:{},cityCode:[],popupFlag:!1,subscribeFlag:!0,canbesent:!1}},methods:{checkForm:function(){var t=/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;"[]"===this.cityCode?(e.showModal({content:"请选择地区！",showCancel:!1}),this.canbesent=!1):""==this.biddingType?(e.showModal({content:"请选择招标类型！",showCancel:!1}),this.canbesent=!1):""==this.keyword?(e.showModal({content:"请输入关键字！",showCancel:!1}),this.canbesent=!1):""===this.email?(e.showModal({content:"请输入邮箱！",showCancel:!1}),this.canbesent=!1):t.test(this.email)?this.canbesent=!0:(e.showModal({content:"邮箱格式输入错误，请重新输入！",showCancel:!1}),this.canbesent=!1)},change:function(e){this.current=e,console.log(this.current)},changezbShow:function(){this.zbShow=!0},confirm:function(e){console.log(e[0].label),this.biddingType=e[0].label},chooseCity:function(){for(var e=this,t=this.$refs.tkitree.treeList,s=0;s<this.city.length;s++)t.some((function(t){t.id===e.city[s].value&&(t.checked=!0)}));console.log(t),this.$refs.tkitree._show()},treeConfirm:function(e){console.log(e),this.city=e;var t=[];e.forEach((function(e){t.push(e.value)})),this.cityCode=t,console.log(this.$refs.tkitree.treeList)},addSubscribe:function(){var t=this,s=e.getStorageSync("zbgerUserInfo");if(s){if(console.log(JSON.stringify(this.UserInfo)+typeof JSON.stringify(this.UserInfo)),this.checkForm(),!0===this.canbesent){console.log(this.canbesent);var n=this.UserInfo.openId;e.request({url:"https://zbger.com:8443/zbger/subscribe/addSubscribe",method:"POST",data:{IntoAreaCodes:this.cityCode,subscribeType:this.biddingType,subscribeDesc:this.keyword,subscribeEmail:this.email,openid:n},success:function(s){if(console.log(s),200===s.data.code){var n={areaCodes:t.cityCode,subscribeType:t.biddingType,subscribeDesc:t.keyword,subscribeEmail:t.email},i=e.getStorageSync("zbgerUserInfo");i.subscribe=n,e.setStorageSync("zbgerUserInfo",i);var o=e.getStorageSync("getLocationFlag");o=!1,e.setStorageSync("getLocationFlag",o),e.switchTab({url:"../../index/index"})}}})}}else this.popupFlag=!0},changeSubscribe:function(){var t=this;if(""===this.UserInfo)this.popupFlag=!0;else{var s=this.UserInfo.openId;this.checkForm(),console.log(this.UserInfo),!0===this.canbesent&&e.request({url:"https://zbger.com:8443/zbger/subscribe/changeSubscribe",method:"POST",data:{IntoAreaCodes:this.cityCode,subscribeType:this.biddingType,subscribeDesc:this.keyword,subscribeEmail:this.email,openid:s},success:function(s){console.log(s);var n={areaCodes:t.cityCode,subscribeType:t.biddingType,subscribeDesc:t.keyword,subscribeEmail:t.email},i=e.getStorageSync("zbgerUserInfo");i.subscribe=n,e.setStorageSync("zbgerUserInfo",i);var o=e.getStorageSync("getLocationFlag");o=!1,e.setStorageSync("getLocationFlag",o),e.switchTab({url:"../../index/index"})},fail:function(){console.log("fail")}})}},login:function(t){var s=this,n=t.detail.userInfo,i=n.avatarUrl,o=n.nickName;console.log(n),e.login({success:function(t){var n=t.code,c={};c.avatarUrl=i,c.nickName=o,s.popupFlag=!1,e.request({url:"https://zbger.com:8443/zbger/wechatAppletsUser/login",method:"POST",data:{avatarUrl:i,nickName:o,code:n},success:function(t){if(console.log(t),0===t.data.code){c.openId=t.data.msg,e.setStorageSync("zbgerUserInfo",c),s.UserInfo=e.getStorageSync("zbgerUserInfo");var n=e.getStorageSync("getLocationFlag");n=!1,e.setStorageSync("getLocationFlag",n),e.switchTab({url:"../subscribe/subscribe"}),s.$refs.uToast.show({title:"登录成功",type:"success",position:"top"})}else s.$refs.uToast.show({title:"授权失败",type:"err",position:"top"})}})}})}},components:{label:o,tkiTree:c},onShow:function(){this.areaList=n.default;var t,s=e.getStorageSync("zbgerUserInfo"),i=this;s?(this.UserInfo=s,s.subscribe?function(){i.city=[],i.subscribeFlag=!1,i.biddingType=s.subscribe.subscribeType,i.keyword=s.subscribe.subscribeDesc,i.email=s.subscribe.subscribeEmail;var e=s.subscribe.areaCodes;for(t=0;t<e.length;t++)n.default.forEach((function(s){s.value===e[t]?(i.city.push(s),i.cityCode.push(s.value)):null!==s.children&&s.children.forEach((function(s){s.value===e[t]&&(i.city.push(s),i.cityCode.push(s.value))}))}))}():e.request({url:"https://zbger.com:8443/zbger/subscribe/findSubscribeByOpenid",data:{openid:s.openId},success:function(t){if(0===t.data.code){var o,c=[];if(t.data.data.subscribe)(function(){t.data.data.subscribe.areaCodes.forEach((function(e){c.push(e.areaCode)}));var a=t.data.data.subscribe.subscribeType,r=t.data.data.subscribe.subscribeDesc,u=t.data.data.subscribe.subscribeEmail,l={areaCodes:c,subscribeType:a,subscribeDesc:r,subscribeEmail:u};s.subscribe=l,e.setStorageSync("zbgerUserInfo",s),s=e.getStorageSync("zbgerUserInfo"),i.city=[],i.subscribeFlag=!1,i.biddingType=s.subscribe.subscribeType,i.keyword=s.subscribe.subscribeDesc,i.email=s.subscribe.subscribeEmail;var b=s.subscribe.areaCodes;for(o=0;o<b.length;o++)n.default.forEach((function(e){e.value===b[o]?(i.city.push(e),i.cityCode.push(e.value)):null!==e.children&&e.children.forEach((function(e){e.value===b[o]&&(i.city.push(e),i.cityCode.push(e.value))}))}))})()}}})):(i.subscribeFlag=!0,i.cityCode=[],i.keyword="",i.email="",i.city=[{name:"北京",value:1},{name:"上海",value:2},{name:"广州",value:3},{name:"深圳",value:4}])}};t.default=a}).call(this,s("543d")["default"])},"32dd":function(e,t,s){"use strict";s.r(t);var n=s("d5ee"),i=s("0587");for(var o in i)"default"!==o&&function(e){s.d(t,e,(function(){return i[e]}))}(o);s("8c3a");var c,a=s("f0c5"),r=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],c);t["default"]=r.exports},"8c3a":function(e,t,s){"use strict";var n=s("c6dc"),i=s.n(n);i.a},c6dc:function(e,t,s){},d5ee:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"c",(function(){return o})),s.d(t,"a",(function(){return n}));var n={uTabsSwiper:function(){return Promise.all([s.e("common/vendor"),s.e("node-modules/uview-ui/components/u-tabs-swiper/u-tabs-swiper")]).then(s.bind(null,"982a"))},uSelect:function(){return s.e("node-modules/uview-ui/components/u-select/u-select").then(s.bind(null,"208d"))},tkiTree:function(){return s.e("components/tki-tree/tki-tree").then(s.bind(null,"5c78"))},uPopup:function(){return s.e("node-modules/uview-ui/components/u-popup/u-popup").then(s.bind(null,"8910"))},uButton:function(){return s.e("node-modules/uview-ui/components/u-button/u-button").then(s.bind(null,"92a9"))},uToast:function(){return s.e("node-modules/uview-ui/components/u-toast/u-toast").then(s.bind(null,"874a"))}},i=function(){var e=this,t=e.$createElement;e._self._c},o=[]},f54f:function(e,t,s){"use strict";(function(e){s("78ac");n(s("66fd"));var t=n(s("32dd"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,s("543d")["createPage"])}},[["f54f","common/runtime","common/vendor"]]]);